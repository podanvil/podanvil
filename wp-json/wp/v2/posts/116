{"id":116,"date":"2023-07-30T19:32:15","date_gmt":"2023-07-30T19:32:15","guid":{"rendered":"https:\/\/thaodean.com\/?p=116"},"modified":"2023-07-31T00:45:02","modified_gmt":"2023-07-31T00:45:02","slug":"optimizing-ffmpeg-for-av1-encoding-with-svt-av1","status":"publish","type":"post","link":"https:\/\/thaodean.com\/sw\/optimizing-ffmpeg-for-av1-encoding-with-svt-av1\/","title":{"rendered":"Optimizing FFmpeg for AV1 Encoding with SVT-AV1"},"content":{"rendered":"\n<p>In the realm of open-source video encoding, ffmpeg stands out as a versatile and powerful tool. Its capabilities range from simple video conversions to complex transcoding, filtering, and streaming tasks. Today, I&#8217;ll share some insights into optimizing ffmpeg for AV1 encoding using the Scalable Video Technology for AV1 (SVT-AV1) encoder.<\/p>\n\n\n\n<p>AV1 is a high-efficiency video codec that improves over predecessors like VP9 and HEVC\/H.265. It offers superior compression efficiency, reducing file sizes without sacrificing quality. However, AV1 encoding can be resource-intensive. SVT-AV1, an open-source project backed by Intel and Netflix, offers a performant encoder that can help balance efficiency with resource usage.<\/p>\n\n\n\n<p>Here are the default ffmpeg settings I use for encoding videos with AV1 using the SVT-AV1 encoder:<\/p>\n\n\n\n<pre class=\"wp-block-code has-white-color has-light-gray-background-color has-text-color has-background has-regular-font-size\"><code lang=\"bash\" class=\"language-bash\">ffmpeg -i input.mp4 -c:v libsvtav1 -preset 5 -crf 28 -g 240 -pix_fmt yuv420p10le -svtav1-params tune=0:film-grain=10 -c:a libopus -b:a 100k output.mkv<\/code><\/pre>\n\n\n\n<p><strong>Video and Audio Settings<\/strong><\/p>\n\n\n\n<p>The command includes a set of parameters tailored to optimize the encoding process:<\/p>\n\n\n\n<ol>\n<li><strong>-c:v libsvtav1<\/strong>: This instructs ffmpeg to use the SVT-AV1 library for video encoding. SVT-AV1 is renowned for its efficient balance between encoding speed and video quality.<\/li>\n\n\n\n<li><strong>-preset 5<\/strong>: A preset is a collection of options that will provide a certain encoding speed to compression ratio. A lower preset will provide better compression (smaller output file size) at the cost of encoding speed, while a higher preset will encode faster but with less compression. A preset of 5 is a good balance between encoding speed and compression ratio.<\/li>\n\n\n\n<li><strong>-crf 28<\/strong>: The Constant Rate Factor (CRF) value influences the video quality during encoding. Lower values yield better quality but larger files, while higher values provide more compression but at the expense of quality. A CRF of 28 is a reasonable choice for maintaining good video quality while achieving satisfactory compression.<\/li>\n\n\n\n<li><strong>-g 240<\/strong>: The <code>-g<\/code> option sets the group of pictures (GOP) size, which is the distance between keyframes. A keyframe is a frame where a complete image is stored in the data stream. In video compression, only changes that occur from one frame to the next are stored in the data stream, enabling significant data savings. A GOP size of 240 frames means a keyframe will be inserted at least every 240 frames. This balances between video quality, file size, and the ability to seek within the video.<\/li>\n\n\n\n<li><strong>-pix_fmt yuv420p10le:<\/strong> This sets the pixel format to a widely recognized format, using 10 bits per color channel. This can slightly boost compression while preserving video quality. Sometimes, simply changing a video recording&#8217;s pixel format\u2014especially from a rare camera pixel format to a more common one like yuv420p\u2014can enhance compatibility.<\/li>\n\n\n\n<li><strong>-svtav1-params tune=0:film-grain=10<\/strong>: Here, we pass direct parameters to the SVT-AV1 encoder. The <code>tune=0<\/code> parameter optimizes for visual quality. The <code>film-grain=10<\/code> parameter simulates film grain, which can potentially reduce file size by smoothing out noise during compression.<\/li>\n\n\n\n<li><strong>-c:a libopus -b:a 100k<\/strong>: This command specifies the libopus codec for audio encoding at a bitrate of 100k. Despite the relatively low bitrate, libopus is capable of delivering clear and detailed sound, which makes it ideal for capturing even subtle audio nuances. It&#8217;s a free, future-proof, universally compatible codec favored by the open-source community for its robust performance and excellent quality-to-size ratio.<\/li>\n<\/ol>\n\n\n\n<p><strong>Output Format<\/strong><\/p>\n\n\n\n<p>We choose MKV as our output format. While both MP4 and MKV support a wide variety of codecs, including AV1 and Opus, MKV has a few key advantages that make it more suitable for our use case. MKV is known for its robustness and flexibility, offering features such as error resilience, which is beneficial for maintaining video playback even if the file has minor corruptions. MKV also supports features like fast seeking and chapter markers, which can be useful for navigation within longer videos. Its open-source nature and wide support in the multimedia community further add to its appeal.<\/p>\n\n\n\n<p>Remember, these settings are a starting point. The optimal parameters depend on your specific use case, input media, and hardware capabilities. However, these settings should provide a reasonable balance between quality, file size, and encoding time for a wide range of scenarios.<\/p>\n\n\n\n<p><strong>Note on System Performance<\/strong><\/p>\n\n\n\n<p>Encoding AV1, particularly with SVT-AV1, is a demanding process that can consume significant CPU resources. As a result, you may experience system slowdowns during the encoding process. If your system includes a dedicated graphics card that supports AV1 hardware encoding, you could reduce the CPU load by leveraging the power of your GPU.<\/p>\n\n\n\n<p>So, if you have access to ffmpeg in the command line, give these settings a try. Experiment with different parameters, see what works best for your needs, and share your findings with the community. Happy encoding<\/p>\n","protected":false},"excerpt":{"rendered":"<p>In the realm of open-source video encoding, ffmpeg stands out as a versatile and powerful tool. Its capabilities range from simple video conversions to complex transcoding, filtering, and streaming tasks. Today, I&#8217;ll share some insights into optimizing ffmpeg for AV1&#8230; <a class=\"more-link\" href=\"https:\/\/thaodean.com\/sw\/optimizing-ffmpeg-for-av1-encoding-with-svt-av1\/\">Continue Reading &rarr;<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[16,11],"tags":[25,23,22,33,34,24,31,35,27,28,26,30,29,32],"acf":[],"jetpack_featured_media_url":"","jetpack-related-posts":[{"id":127,"url":"https:\/\/thaodean.com\/media\/compression\/choosing-the-right-video-codec-nvenc-x264-and-av1\/","url_meta":{"origin":116,"position":0},"title":"Choosing the Right Video Codec: NVENC, x264, and AV1","author":"thaodean","date":"07\/31\/2023","format":false,"excerpt":"Picking the right video codec can make a big difference in your video's quality and the time it takes to record. Let's look at three important ones: NVENC, x264, and AV1. NVENC is great for recording high-quality videos quickly. It uses the power of Nvidia GPUs, freeing up your computer's\u2026","rel":"","context":"In &quot;Compression&quot;","block_context":{"text":"Compression","link":"https:\/\/thaodean.com\/category\/media\/compression\/"},"img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":68,"url":"https:\/\/thaodean.com\/media\/the-uninvited-houseguest-dealing-with-the-accidental-10gb-video\/","url_meta":{"origin":116,"position":1},"title":"The Uninvited Houseguest: Dealing with the Accidental 10GB Video","author":"thaodean","date":"07\/25\/2023","format":false,"excerpt":"In the grand garden party of our digital lives, our media files are like an assortment of guests. Photos are the charming social butterflies flitting around, documents are the articulate conversationalists, and music files are, well, the life of the party. But every now and then, there's that uninvited houseguest\u2026","rel":"","context":"In &quot;Compression&quot;","block_context":{"text":"Compression","link":"https:\/\/thaodean.com\/category\/media\/compression\/"},"img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":95,"url":"https:\/\/thaodean.com\/media\/compression\/the-exhilarating-challenge-of-maxing-out-digital-space-my-journey-with-4k-recording\/","url_meta":{"origin":116,"position":2},"title":"The Exhilarating Challenge of Maxing Out Digital Space: My Journey with 4K Recording","author":"thaodean","date":"07\/27\/2023","format":false,"excerpt":"In our digital age, many might find the notion of willingly running out of disk space a bit strange, if not downright absurd. Yet, that's exactly the challenge I've willingly undertaken, a personal endeavour that blends technology, creativity, and perseverance in one exciting package. 4K resolution has undeniably revolutionized the\u2026","rel":"","context":"In &quot;Compression&quot;","block_context":{"text":"Compression","link":"https:\/\/thaodean.com\/category\/media\/compression\/"},"img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":40,"url":"https:\/\/thaodean.com\/kubernetes\/to-kubernetes-or-not-making-the-decision-for-your-personal-project\/","url_meta":{"origin":116,"position":3},"title":"To Kubernetes or Not: Making the Decision for Your Personal Project","author":"thaodean","date":"07\/22\/2023","format":false,"excerpt":"Are you planning a personal project and pondering whether Kubernetes is the right choice? Deciding on an orchestration platform can be a challenging task, especially when you have to choose between convenience and control, ease of use and complexity. This article will guide you through key considerations, helping you decide\u2026","rel":"","context":"In &quot;Kubernetes&quot;","block_context":{"text":"Kubernetes","link":"https:\/\/thaodean.com\/category\/kubernetes\/"},"img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":99,"url":"https:\/\/thaodean.com\/sw\/rust\/choosing-the-right-rust-web-framework-a-comparison-of-rocket-vs-actix-web\/","url_meta":{"origin":116,"position":4},"title":"Choosing the Right Rust Web Framework: A Comparison of Rocket vs. Actix-web","author":"thaodean","date":"07\/28\/2023","format":false,"excerpt":"Introduction: As Rust gains popularity in the web development community, developers often face the challenge of selecting the right web framework for their projects. Two prominent contenders, Rocket and Actix-web, stand out as strong candidates. In this article, we'll explore a concise comparison of Rocket and Actix-web, focusing on their\u2026","rel":"","context":"In &quot;Rust&quot;","block_context":{"text":"Rust","link":"https:\/\/thaodean.com\/category\/sw\/rust\/"},"img":{"alt_text":"","src":"https:\/\/i0.wp.com\/thaodean.com\/wp-content\/uploads\/2023\/07\/Screenshot-from-2023-04-14-10-38-53-1.png?fit=1200%2C675&ssl=1&resize=350%2C200","width":350,"height":200,"srcset":"https:\/\/i0.wp.com\/thaodean.com\/wp-content\/uploads\/2023\/07\/Screenshot-from-2023-04-14-10-38-53-1.png?fit=1200%2C675&ssl=1&resize=350%2C200 1x, https:\/\/i0.wp.com\/thaodean.com\/wp-content\/uploads\/2023\/07\/Screenshot-from-2023-04-14-10-38-53-1.png?fit=1200%2C675&ssl=1&resize=700%2C400 2x, https:\/\/i0.wp.com\/thaodean.com\/wp-content\/uploads\/2023\/07\/Screenshot-from-2023-04-14-10-38-53-1.png?fit=1200%2C675&ssl=1&resize=1050%2C600 3x"},"classes":[]},{"id":74,"url":"https:\/\/thaodean.com\/sw\/serving-your-wordpress-site-as-static-files-with-rust-and-kubernetes\/","url_meta":{"origin":116,"position":5},"title":"Serving Your WordPress Site as Static Files with Rust and Kubernetes","author":"thaodean","date":"07\/26\/2023","format":false,"excerpt":"In today's fast-moving world, website performance and security are critical. One interesting way to maximize these aspects is by serving your WordPress site as static files, updated daily, with a Rust server running on Kubernetes. In this article, we'll explore the benefits, challenges, and steps involved in this process. Why\u2026","rel":"","context":"In &quot;Kubernetes&quot;","block_context":{"text":"Kubernetes","link":"https:\/\/thaodean.com\/category\/sw\/kubernetes-sw\/"},"img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"rttpg_featured_image_url":null,"rttpg_author":{"display_name":"thaodean","author_link":"https:\/\/thaodean.com\/author\/thaodean\/"},"rttpg_comment":0,"rttpg_category":"<a href=\"https:\/\/thaodean.com\/category\/media\/compression\/\" rel=\"category tag\">Compression<\/a> <a href=\"https:\/\/thaodean.com\/category\/sw\/\" rel=\"category tag\">SW<\/a>","rttpg_excerpt":"In the realm of open-source video encoding, ffmpeg stands out as a versatile and powerful tool. Its capabilities range from simple video conversions to complex transcoding, filtering, and streaming tasks. Today, I&#8217;ll share some insights into optimizing ffmpeg for AV1... Continue Reading &rarr;","_links":{"self":[{"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/posts\/116"}],"collection":[{"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/comments?post=116"}],"version-history":[{"count":11,"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/posts\/116\/revisions"}],"predecessor-version":[{"id":134,"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/posts\/116\/revisions\/134"}],"wp:attachment":[{"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/media?parent=116"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/categories?post=116"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/thaodean.com\/wp-json\/wp\/v2\/tags?post=116"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}